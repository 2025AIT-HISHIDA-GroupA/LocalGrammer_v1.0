{% extends "base.html" %}

{% block title %}投稿 - 投稿アプリ{% endblock %}

{% block content %}
<h2>新しい投稿</h2>

<form method="POST" enctype="multipart/form-data">
    <div class="form-group">
        <label>画像をアップロード (最大4枚):</label>
        <div style="margin-bottom: 10px;">
            <input type="file" id="image1" name="image1" accept="image/*">
            <label for="image1" style="font-weight: normal; margin-left: 5px;">画像1</label>
        </div>
        <div style="margin-bottom: 10px;">
            <input type="file" id="image2" name="image2" accept="image/*">
            <label for="image2" style="font-weight: normal; margin-left: 5px;">画像2</label>
        </div>
        <div style="margin-bottom: 10px;">
            <input type="file" id="image3" name="image3" accept="image/*">
            <label for="image3" style="font-weight: normal; margin-left: 5px;">画像3</label>
        </div>
        <div style="margin-bottom: 10px;">
            <input type="file" id="image4" name="image4" accept="image/*">
            <label for="image4" style="font-weight: normal; margin-left: 5px;">画像4</label>
        </div>
        <small style="color: #666;">対応形式: PNG, JPG, JPEG, GIF, WebP</small>
    </div>

    <div class="form-group">
        <label for="tag">タグ:</label>
        <select id="tag" name="tag" required>
            <option value="">選択してください</option>
            {% for tag in tags %}
            <option value="{{ tag }}">{{ tag }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label for="region">地域:</label>
        <select id="region" name="region" required>
            <option value="">選択してください</option>
            {% for region in regions %}
            <option value="{{ region }}">{{ region }}</option>
            {% endfor %}
        </select>
    </div>

    <div style="display: flex; gap: 15px; margin-top: 20px;">
        <button type="submit" class="btn" style="min-width: 120px;">投稿</button>
        <a href="{{ url_for('main.home') }}" class="btn btn-secondary"
            style="min-width: 120px; text-align: center;">キャンセル</a>
    </div>
</form>

<script>
    // 画像プレビュー機能
    function setupImagePreview(inputId) {
        const input = document.getElementById(inputId);
        input.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                // 既存のプレビューを削除
                const existingPreview = document.getElementById(inputId + '_preview');
                if (existingPreview) {
                    existingPreview.remove();
                }

                // 新しいプレビューを作成
                const reader = new FileReader();
                reader.onload = function (e) {
                    const preview = document.createElement('div');
                    preview.id = inputId + '_preview';
                    preview.innerHTML = `<img src="${e.target.result}" style="width: 100px; height: 100px; object-fit: cover; margin-top: 5px; border-radius: 4px;">`;
                    input.parentElement.appendChild(preview);
                };
                reader.readAsDataURL(file);
            }
        });
    }

    // 全ての画像入力にプレビュー機能を追加
    setupImagePreview('image1');
    setupImagePreview('image2');
    setupImagePreview('image3');
    setupImagePreview('image4');
</script>
{% endblock %}